# Программа управление четырехканальным источником питания

## Реализация
Телеметрия реализована в отдельном процессе, который логирует состояние прибора в файл telemetry_log.log. Файл пишется определенное время, потом стирается и запись начинается сначала. Процесс телеметрии поддерживает в разделямой памяти структуру данных типа multiprocessing.sharedctypes.Array, которая хранит последний срез показаний прибора. Синхронизация доступа осуществляется при помощи стандартного для данной структуры внутреннего механизма.
API управления прибором реализовано при помощи HTTP-сервера uvicorn с использованием fastapi. Команды управления (вкл/выкл канал) передаются прибору через сокеты. Получение данных о текущем состоянии прибора осуществляется через доступ к ранее описанной структуре данных в разделямой памяти.
С целью проведения тестирования в состав проекта включен симулятор (src/simulator.py). Он упрощенно имитирует ответы прибора на команды.
Настройки конфигурации собраны в классе src/config/settings/Settings. Сейчас это константные значения, статично хранящиеся в файле, однако в будущем должен быть разработан механизм их получения, например через переменные окружения.

![Схема]("https://disk.yandex.ru/i/T1EnwCNSHfMDDw")

## Начало работы
Для начала работы необходимо клонировать репозиторий в папку на локальной машине, где у пользователя есть право на создание файлов.

Для работы системы необходимы:
* make
* poetry

## Команды:
* make sim - запускает симулятор источника питания
* make  - запускает телеметрию и HTTP API сервер
* make test - запускает тесты

## Тестирование
К сожалению за отведенное время удалось реализовать лишь незначительную часть тех тестов, которые должны быть написаны.
Последовательность шагов при тестировании:
```
make sim & - запускает симулятор прибора
make test  - запускает тесты
make       - запускает телеметрию и HTTP API сервер
```
Далее можно наблюдать заполнение/очистку файла telemetry_log.log.
А также работу HTTP API по адресу из настроек (по умолчанию 127.0.0.1:8001). Для ознакомления с HTTP API можно ввести в адресной строке браузера 127.0.0.1:8001/swagger.
